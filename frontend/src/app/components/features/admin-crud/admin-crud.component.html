<div class="container my-4">
  <h2 class="mb-4">Admin â€“ CRUD Management</h2>

  <!-- Navigation -->
  <ul class="nav nav-tabs mb-3">
    <li class="nav-item"><a class="nav-link" [class.active]="selectedSection==='teachers'"
        (click)="loadData('teachers')">Teachers</a></li>
    <li class="nav-item"><a class="nav-link" [class.active]="selectedSection==='users'"
        (click)="loadData('users')">Users</a></li>
    <li class="nav-item"><a class="nav-link" [class.active]="selectedSection==='courses'"
        (click)="loadData('courses')">Courses</a></li>
    <li class="nav-item"><a class="nav-link" [class.active]="selectedSection==='classes'"
        (click)="loadData('classes')">Classes</a></li>
    <li class="nav-item"><a class="nav-link" [class.active]="selectedSection==='evals'"
        (click)="loadData('evals')">Evals</a></li>
  </ul>

  <div *ngIf="msg" class="alert alert-info">{{ msg }}</div>

  <!-- Teachers -->
  <div *ngIf="selectedSection==='teachers'">
    <h3>Teachers (validated only)</h3>
    <table class="table table-bordered">
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Specialty</th>
        <th>Status</th>
      </tr>
      <tr *ngFor="let t of teachers">
        <ng-container *ngIf="t.teacherValidated">
          <td>{{ t.firstName }} {{ t.lastName }}</td>
          <td>{{ t.email }}</td>
          <td>{{ t.teacherSpecialty || 'â€”' }}</td>
          <td>âœ… Validated</td>
        </ng-container>
      </tr>
    </table>
  </div>

  <!-- Users -->
  <div *ngIf="selectedSection==='users'">
    <h3>Users</h3>
    <button class="btn btn-danger mb-2" (click)="deleteAllUsers()">Delete All Users</button>
    <table class="table table-bordered">
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Actions</th>
      </tr>
      <tr *ngFor="let u of users">
        <td>{{ u.firstName }} {{ u.lastName }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.role }}</td>
        <td>
          <!-- âœ… Bouton de validation pour teachers non validÃ©s -->
          <button *ngIf="u.role === 'teacher' && !u.teacherValidated" class="btn btn-sm btn-success me-1"
            (click)="onValidateTeacher(u._id!)">
            Validate
          </button>
          <!-- ðŸ—‘ï¸ Bouton Delete pour tous les rÃ´les -->
          <button class="btn btn-sm btn-danger" (click)="deleteUser(u._id!)">
            Delete
          </button>
        </td>
      </tr>
    </table>
  </div>

  <!-- Courses -->
  <div *ngIf="selectedSection==='courses'">
    <h3>Courses</h3>
    <button class="btn btn-danger mb-2" (click)="deleteAllCourses()">Delete All Courses</button>
    <table class="table table-bordered">
      <tr>
        <th>Title</th>
        <th>Level</th>
        <th>Description</th>
        <th>Assigned Teachers</th>
        <th>Actions</th>
      </tr>
      <tr *ngFor="let c of courses">
        <td>{{ c.courseTitle }}</td>
        <td>{{ c.courseLevel }}</td>
        <td>{{ c.courseDescription }}</td>
        <td>
          <ul *ngIf="c.teacherIds?.length; else noTeacher">
            <li *ngFor="let tid of c.teacherIds">{{ getTeacherName(tid) }}</li>
          </ul>
          <ng-template #noTeacher>â€”</ng-template>
        </td>
        <td><button class="btn btn-sm btn-danger" (click)="deleteCourse(c._id!)">Delete</button></td>
      </tr>
    </table>
  </div>

  <!-- Classes -->
  <div *ngIf="selectedSection==='classes'">
    <h3>Classes</h3>
    <button class="btn btn-danger mb-2" (click)="deleteAllClasses()">Delete All Classes</button>
        <!-- Class Table -->
    <table class="table table-bordered">
      <tr>
        <th>Name</th>
        <th>Year</th>
        <th>Actions</th>
      </tr>
      <tr *ngFor="let cls of classes">
        <td>{{ cls.className }}</td>
        <td>{{ cls.classYear }}</td>
        <td><button class="btn btn-sm btn-danger" (click)="deleteClass(cls._id!)">Delete</button></td>
      </tr>
    </table>
  </div>
    <!-- Add Class -->
    <div *ngIf="selectedSection==='classes'" class="mb-4">
      <h3>Add Class</h3>
      <form (ngSubmit)="onAddClass()" #classForm="ngForm" class="row g-2 align-items-end">
        <div class="col-md-5">
          <input type="text" class="form-control" placeholder="Class name" name="className"
            [(ngModel)]="newClass.className" required>
        </div>
        <div class="col-md-5">
          <input type="text" class="form-control" placeholder="Year" name="classYear" [(ngModel)]="newClass.classYear"
            required>
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100">Add</button>
        </div>
      </form>
    </div>

  <!-- Evals -->
  <div *ngIf="selectedSection==='evals'">
    <h3>Evals</h3>
    <button class="btn btn-danger mb-2" (click)="deleteAllEvals()">Delete All Evals</button>
    <table class="table table-bordered">
      <tr>
        <th>Student</th>
        <th>Course</th>
        <th>Note</th>
        <th>Actions</th>
      </tr>
      <tr *ngFor="let e of evals">
        <td>{{ e.studentId?.firstName }}</td>
        <td>{{ e.courseId?.title }}</td>
        <td>{{ e.evalNote }}</td>
        <td>{{ e.evalStatus }}</td>
        <td>{{ e.evalComment }}</td>
        <td>
          <button class="btn btn-sm btn-warning" (click)="editEval(e)">Edit</button>
          <button class="btn btn-sm btn-danger" (click)="deleteEval(e._id!)">Delete</button>
        </td>
      </tr>
    </table>
  </div>
</div>